name: Pipeline CI-CD HTML-CSS

on:
  push:
    branches: [ "main" ]

jobs:
  check-files:
    runs-on: self-hosted
    steps:
      - name: Récupérer le code
        uses: actions/checkout@v4

      - name: Vérification des fichiers
        run: |
          echo "Vérification de la présence des fichiers..."
          ls -R # Liste les fichiers pour vérifier que tout est bien là

  sonarqube-analysis:
    needs: check-files
    runs-on: self-hosted
    steps:
      - name: Récupérer le code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Scan avec SonarScanner
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
        run: |
          sonar-scanner \
            -Dsonar.projectKey=Devo_test \
            -Dsonar.sources=. \
            -Dsonar.host.url=http://localhost:9000 \
            -Dsonar.login=${{ secrets.SONAR_TOKEN }}

  deploy:
    needs: sonarqube-analysis
    runs-on: self-hosted
    steps:
      - name: Déploiement Local
        run: |
          echo "Analyse terminée avec succès."
          # Exemple : Copier les fichiers vers ton dossier de serveur web local (ex: Apache ou Nginx)
          # xcopy . C:\xampp\htdocs\mon_projet /E /Y  (Pour Windows)
          # cp -r . /var/www/html/mon_projet (Pour Linux)